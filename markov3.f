      PROGRAM MARKOV3
C  THIS PROGRAM REQUIRES LONG INTEGERS
      DIMENSION NS(3),P(3,3),PP(3)
      IDUM=-567
C
C  READING IN ROWS OF STOCHASTIC MATRIX
      DO 1 I=1,3
      WRITE(6,60)I
   60 FORMAT(10H INPUT ROW,I2,10H OF MATRIX)
      READ(5,*)(P(I,J),J=1,3)
      S=P(I,1)+P(I,2)+P(I,3)
      IF((S-1.0)**2.LT.1.0E-8)GOTO 1
      WRITE(6,'('' SUM OF PROBABILITIES NOT EQUAL TO 1. '')')
      WRITE(6,'('' PROGRAM ABORTED. '')')
      GOTO 100
    1 CONTINUE    
C  CLEAR TABLE
      DO 4 I=1,3
      NS(I)=0
    4 CONTINUE
C
C  FIX AN INITIAL VARIABLE
      N=1
C
      DO 2 I=1,1000000
      X=RAN1(IDUM)
C  SELECT NEXT VARIABLE IF PRESENT ONE IS THE FIRST
      IF(N.EQ.1)THEN
      IF(X.LT.P(1,1)+P(1,2))GOTO 13
      N1=3
      GOTO 50
   13 IF(X.LT.P(1,1))GOTO 14
      N1=2
      GOTO 50
   14 N1=1
      GOTO 50
      ENDIF
C
C  SELECT NEXT VARIABLE IF PRESENT ONE IS THE SECOND
      IF(N.EQ.2)THEN
      IF(X.LT.P(2,1)+P(2,2))GOTO 15
      N1=3
      GOTO 50
   15 IF(X.LT.P(2,1))GOTO 16
      N1=2
      GOTO 50
   16 N1=1
      GOTO 50
      ENDIF
C
C  SELECT NEXT VARIABLE IF PRESENT ONE IS THE THIRD
      IF(N.EQ.3)THEN
      IF(X.LT.P(3,1)+P(3,2))GOTO 17
      N1=3
      GOTO 50
   17 IF(X.LT.P(3,1))GOTO 18
      N1=2
      GOTO 50
   18 N1=1
      ENDIF
C
   50 N=N1
      NS(N)=NS(N)+1
    2 CONTINUE
C  OUTPUT RESULT ON SCREEN
      WRITE(6,*)NS
      SUMNS=FLOAT(NS(1)+NS(2)+NS(3))
      DO 5 I=1,3
      PP(I)=NS(I)/SUMNS
    5 CONTINUE
      WRITE(6,200)PP
  200 FORMAT(22H THE PROBABILITIES ARE, 3F8.4)
  100 STOP
      END


      FUNCTION RAN1(IDUM)
      DIMENSION R(97)
      PARAMETER (M1=259200,IA1=7141,IC1=54773,RM1=3.8580247E-6)
      PARAMETER (M2=134456,IA2=8121,IC2=28411,RM2=7.4373773E-6)
      PARAMETER (M3=243000,IA3=4561,IC3=51349)
      DATA IFF /0/
      IF (IDUM.LT.0.OR.IFF.EQ.0) THEN
        IFF=1
        IX1=MOD(IC1-IDUM,M1)
        IX1=MOD(IA1*IX1+IC1,M1)
        IX2=MOD(IX1,M2)
        IX1=MOD(IA1*IX1+IC1,M1)
        IX3=MOD(IX1,M3)
        DO 11 J=1,97
          IX1=MOD(IA1*IX1+IC1,M1)
          IX2=MOD(IA2*IX2+IC2,M2)
          R(J)=(FLOAT(IX1)+FLOAT(IX2)*RM2)*RM1
11      CONTINUE
        IDUM=1
      ENDIF
      IX1=MOD(IA1*IX1+IC1,M1)
      IX2=MOD(IA2*IX2+IC2,M2)
      IX3=MOD(IA3*IX3+IC3,M3)
      J=1+(97*IX3)/M3
      IF(J.GT.97.OR.J.LT.1)PAUSE
      RAN1=R(J)
      R(J)=(FLOAT(IX1)+FLOAT(IX2)*RM2)*RM1
      RETURN
      END

